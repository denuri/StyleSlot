<div class="staff-availability-container">
  <app-navbar></app-navbar>

  <main class="main-content">
    <!-- Access Denied Message -->
    <div class="access-denied"
      *ngIf="errorMessage && (errorMessage.includes('Access denied') || errorMessage.includes('Please log in'))">
      <div class="access-denied-content">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="#ef4444" stroke-width="2" />
          <line x1="15" y1="9" x2="9" y2="15" stroke="#ef4444" stroke-width="2" />
          <line x1="9" y1="9" x2="15" y2="15" stroke="#ef4444" stroke-width="2" />
        </svg>
        <h2>Access Restricted</h2>
        <p>{{ errorMessage }}</p>
        <button class="back-btn" routerLink="/dashboard">Back to Dashboard</button>
      </div>
    </div>

    <div class="content"
      *ngIf="!errorMessage || (!errorMessage.includes('Access denied') && !errorMessage.includes('Please log in'))">
      <div class="header">
        <h1>Staff Availability Management</h1>
        <p>Manage your working hours and breaks for each day of the week</p>
      </div>

      <div class="messages" *ngIf="errorMessage || successMessage">
        <div class="error-message" *ngIf="errorMessage">
          {{ errorMessage }}
          <button class="close-btn" (click)="clearMessages()">×</button>
        </div>
        <div class="success-message" *ngIf="successMessage">
          {{ successMessage }}
          <button class="close-btn" (click)="clearMessages()">×</button>
        </div>
      </div>

      <div class="content-grid">
        <div class="form-section">
          <h2>Add/Edit Availability</h2>
          <form (ngSubmit)="addAvailability()" class="availability-form">
            <div class="form-group">
              <label for="dayOfWeek">Day of Week</label>
              <select id="dayOfWeek" [(ngModel)]="selectedDay" name="dayOfWeek" required>
                <option *ngFor="let day of daysOfWeek" [value]="day">{{ day }}</option>
              </select>
            </div>

            <div class="time-group">
              <div class="form-group">
                <label for="startTime">Start Time</label>
                <input type="time" id="startTime" [(ngModel)]="startTime" name="startTime" required>
              </div>

              <div class="form-group">
                <label for="endTime">End Time</label>
                <input type="time" id="endTime" [(ngModel)]="endTime" name="endTime" required>
              </div>
            </div>

            <div class="breaks-section">
              <div class="breaks-header">
                <h3>Breaks</h3>
                <button type="button" class="add-break-btn" (click)="addBreak()">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line x1="12" y1="5" x2="12" y2="19" stroke="currentColor" stroke-width="2" />
                    <line x1="5" y1="12" x2="19" y2="12" stroke="currentColor" stroke-width="2" />
                  </svg>
                  Add Break
                </button>
              </div>

              <div class="break-item" *ngFor="let break of breaks; let i = index">
                <div class="break-time">
                  <input type="time" [(ngModel)]="break.start" [name]="'breakStart' + i">
                  <span>to</span>
                  <input type="time" [(ngModel)]="break.end" [name]="'breakEnd' + i">
                </div>
                <button type="button" class="remove-break-btn" (click)="removeBreak(i)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <line x1="18" y1="6" x2="6" y2="18" stroke="currentColor" stroke-width="2" />
                    <line x1="6" y1="6" x2="18" y2="18" stroke="currentColor" stroke-width="2" />
                  </svg>
                </button>
              </div>
            </div>

            <div class="form-actions">
              <button type="submit" class="submit-btn" [disabled]="isLoading">
                <span *ngIf="!isLoading">Add Availability</span>
                <span *ngIf="isLoading">Adding...</span>
              </button>
              <button type="button" class="reset-btn" (click)="resetForm()">Reset</button>
            </div>
          </form>
        </div>

        <div class="availabilities-section">
          <h2>Current Availabilities</h2>

          <div class="loading" *ngIf="isLoading">
            <div class="spinner"></div>
            <p>Loading availabilities...</p>
          </div>

          <div class="availabilities-list" *ngIf="!isLoading">
            <div class="availability-card" *ngFor="let availability of availabilities">
              <div class="availability-header">
                <h3>{{ availability.dayOfWeek }}</h3>
                <div class="availability-status">
                  <span class="status-badge available">Available</span>
                </div>
              </div>

              <div class="availability-details">
                <div class="time-range">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" />
                    <polyline points="12,6 12,12 16,14" stroke="currentColor" stroke-width="2" />
                  </svg>
                  <span>{{ availability.startTime }} - {{ availability.endTime }}</span>
                </div>

                <div class="breaks-info" *ngIf="availability.breaks.length > 0">
                  <h4>Breaks:</h4>
                  <ul class="breaks-list">
                    <li *ngFor="let break of availability.breaks">
                      {{ break.start }} - {{ break.end }}
                    </li>
                  </ul>
                </div>

                <div class="no-breaks" *ngIf="availability.breaks.length === 0">
                  <p>No breaks scheduled</p>
                </div>
              </div>

              <div class="availability-actions">
                <button class="edit-btn" (click)="updateAvailability(availability)">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" stroke="currentColor"
                      stroke-width="2" />
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" stroke="currentColor"
                      stroke-width="2" />
                  </svg>
                  Edit
                </button>
              </div>
            </div>

            <div class="empty-state" *ngIf="availabilities.length === 0">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="#9ca3af" stroke-width="2" />
                <polyline points="12,6 12,12 16,14" stroke="#9ca3af" stroke-width="2" />
              </svg>
              <h3>No availabilities set</h3>
              <p>Add your working hours to get started</p>
            </div>
          </div>
        </div>
      </div>

      <div class="weekly-overview">
        <h2>Weekly Overview</h2>
        <div class="week-grid">
          <div class="day-card" *ngFor="let day of daysOfWeek" [class.available]="isDayAvailable(day)">
            <h3>{{ day }}</h3>
            <div class="day-status">
              <span *ngIf="isDayAvailable(day)" class="status available">Available</span>
              <span *ngIf="!isDayAvailable(day)" class="status unavailable">Not Set</span>
            </div>
            <div class="day-time" *ngIf="isDayAvailable(day)">
              <p>{{ getAvailabilityForDay(day)?.startTime }} - {{ getAvailabilityForDay(day)?.endTime }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <app-footer></app-footer>
</div>
