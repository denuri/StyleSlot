<div class="admin-staff-availability-container">
  <app-navbar></app-navbar>

  <main class="main-content">
    <!-- Access Denied Message -->
    <div class="access-denied"
      *ngIf="errorMessage && (errorMessage.includes('Access denied') || errorMessage.includes('Please log in'))">
      <div class="access-denied-content">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="#ef4444" stroke-width="2" />
          <line x1="15" y1="9" x2="9" y2="15" stroke="#ef4444" stroke-width="2" />
          <line x1="9" y1="9" x2="15" y2="15" stroke="#ef4444" stroke-width="2" />
        </svg>
        <h2>Access Restricted</h2>
        <p>{{ errorMessage }}</p>
        <button class="back-btn" routerLink="/dashboard">Back to Dashboard</button>
      </div>
    </div>

    <!-- Main Content (only show if no access error) -->
    <div class="content"
      *ngIf="!errorMessage || (!errorMessage.includes('Access denied') && !errorMessage.includes('Please log in'))">
      <div class="header">
        <h1>Staff Availability Overview</h1>
        <p>View and manage all staff working schedules</p>
      </div>

      <div class="error-message" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>

      <div class="loading" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>Loading staff availabilities...</p>
      </div>

      <div class="staff-overview" *ngIf="!isLoading">
        <div class="stats-section">
          <div class="stat-card">
            <div class="stat-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="#4ade80" stroke-width="2" />
                <circle cx="9" cy="7" r="4" stroke="#4ade80" stroke-width="2" />
              </svg>
            </div>
            <div class="stat-content">
              <h3>{{ getStaffMembers().length }}</h3>
              <p>Total Staff Members</p>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="#3b82f6" stroke-width="2" />
                <polyline points="12,6 12,12 16,14" stroke="#3b82f6" stroke-width="2" />
              </svg>
            </div>
            <div class="stat-content">
              <h3>{{ allAvailabilities.length }}</h3>
              <p>Total Schedules</p>
            </div>
          </div>
        </div>

        <div class="staff-list">
          <div class="staff-card" *ngFor="let staffId of getStaffMembers()">
            <div class="staff-header">
              <div class="staff-info">
                <h3>{{ getStaffName(staffId) }}</h3>
                <p class="staff-email">{{ getStaffEmail(staffId) }}</p>
                <span class="staff-role">{{ getStaffRole(staffId) }}</span>
              </div>
              <div class="staff-stats">
                <div class="stat">
                  <span class="stat-label">Total Hours:</span>
                  <span class="stat-value">{{ getTotalWorkingHours(staffId) }}h</span>
                </div>
                <div class="stat">
                  <span class="stat-label">Total Breaks:</span>
                  <span class="stat-value">{{ getTotalBreaks(staffId) }}</span>
                </div>
              </div>
            </div>

            <div class="weekly-schedule">
              <h4>Weekly Schedule</h4>
              <div class="schedule-grid">
                <div class="day-header" *ngFor="let day of getDaysOfWeek()">
                  <span>{{ day }}</span>
                </div>
                <div class="day-slot" *ngFor="let day of getDaysOfWeek()"
                  [class.available]="isDayAvailable(staffId, day)">
                  <div *ngIf="isDayAvailable(staffId, day)" class="availability-info">
                    <div class="time-range">
                      {{ getAvailabilityForDay(staffId, day)?.startTime }} - {{ getAvailabilityForDay(staffId,
                      day)?.endTime }}
                    </div>
                    <div class="breaks-count" *ngIf="getAvailabilityForDay(staffId, day)?.breaks?.length">
                      {{ getAvailabilityForDay(staffId, day)?.breaks?.length }} break(s)
                    </div>
                  </div>
                  <div *ngIf="!isDayAvailable(staffId, day)" class="no-availability">
                    <span>Not Available</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="detailed-breaks" *ngIf="getTotalBreaks(staffId) > 0">
              <h4>Break Details</h4>
              <div class="breaks-list">
                <div class="break-item" *ngFor="let availability of staffGroups[staffId]">
                  <div class="day-breaks" *ngIf="availability.breaks.length > 0">
                    <h5>{{ availability.dayOfWeek }}</h5>
                    <ul>
                      <li *ngFor="let break of availability.breaks">
                        {{ break.start }} - {{ break.end }}
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="empty-state" *ngIf="getStaffMembers().length === 0">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" stroke="#9ca3af" stroke-width="2" />
              <circle cx="9" cy="7" r="4" stroke="#9ca3af" stroke-width="2" />
            </svg>
            <h3>No Staff Availabilities</h3>
            <p>Staff members haven't set their availability schedules yet.</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <app-footer></app-footer>
</div>
